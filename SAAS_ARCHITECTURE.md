# ğŸ¢ HydroNet SaaSå¤šç§Ÿæˆ·æ¶æ„è®¾è®¡

## ğŸ“Š å½“å‰çŠ¶æ€ vs SaaSç›®æ ‡

### âŒ å½“å‰ç‰ˆæœ¬ï¼ˆå•ç§Ÿæˆ·ï¼‰
```
ç‰¹ç‚¹ï¼š
- æ‰€æœ‰ç”¨æˆ·å…±äº«åŒä¸€ä¸ªç³»ç»Ÿå®ä¾‹
- æ²¡æœ‰ç”¨æˆ·è®¤è¯å’Œæƒé™ç®¡ç†
- å¯¹è¯å†å²æ··åœ¨ä¸€èµ·
- æ— æ³•åŒºåˆ†ä¸åŒç»„ç»‡/å®¢æˆ·
- é€‚åˆï¼šä¸ªäººä½¿ç”¨ã€å†…éƒ¨ç³»ç»Ÿ
```

### âœ… SaaSç‰ˆæœ¬ï¼ˆå¤šç§Ÿæˆ·ï¼‰
```
ç‰¹ç‚¹ï¼š
- æ•°æ®éš”ç¦»ï¼šæ¯ä¸ªç§Ÿæˆ·æ•°æ®ç‹¬ç«‹
- ç”¨æˆ·ç®¡ç†ï¼šæ³¨å†Œã€ç™»å½•ã€æƒé™æ§åˆ¶
- èµ„æºé™é¢ï¼šAPIè°ƒç”¨æ¬¡æ•°ã€å­˜å‚¨é…é¢
- è®¡è´¹ç³»ç»Ÿï¼šæŒ‰ä½¿ç”¨é‡è®¡è´¹
- é€‚åˆï¼šå•†ä¸šåŒ–SaaSæœåŠ¡
```

---

## ğŸ—ï¸ å¤šç§Ÿæˆ·æ¶æ„è®¾è®¡

### æ¶æ„å±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   è®¿é—®å±‚                             â”‚
â”‚  Webç•Œé¢ / å¾®ä¿¡ / API / ç§»åŠ¨APP                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  è®¤è¯æˆæƒå±‚                          â”‚
â”‚  â€¢ ç”¨æˆ·æ³¨å†Œ/ç™»å½•                                     â”‚
â”‚  â€¢ JWT Token                                         â”‚
â”‚  â€¢ ç§Ÿæˆ·è¯†åˆ«                                          â”‚
â”‚  â€¢ æƒé™éªŒè¯ (RBAC)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ç§Ÿæˆ·éš”ç¦»å±‚                          â”‚
â”‚  â€¢ ç§Ÿæˆ·IDæ³¨å…¥                                        â”‚
â”‚  â€¢ æ•°æ®è¿‡æ»¤                                          â”‚
â”‚  â€¢ èµ„æºé…é¢æ£€æŸ¥                                      â”‚
â”‚  â€¢ è¯·æ±‚é™æµ                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ä¸šåŠ¡é€»è¾‘å±‚                          â”‚
â”‚  â€¢ AIå¯¹è¯æœåŠ¡                                        â”‚
â”‚  â€¢ MCPæœåŠ¡ç®¡ç†                                       â”‚
â”‚  â€¢ æ•°æ®åˆ†æ                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ•°æ®å­˜å‚¨å±‚                         â”‚
â”‚  â€¢ ç§Ÿæˆ·æ•°æ®éš”ç¦»ï¼ˆå…±äº«è¡¨ + tenant_idï¼‰                â”‚
â”‚  â€¢ æˆ–ç‹¬ç«‹æ•°æ®åº“ï¼ˆæ›´å¼ºéš”ç¦»ï¼‰                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„

#### 1. ç§Ÿæˆ·è¡¨ (tenants)
```sql
CREATE TABLE tenants (
    id VARCHAR(36) PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    subdomain VARCHAR(50) UNIQUE,  -- ä¾‹å¦‚ï¼šcustomer1.hydronet.com
    plan VARCHAR(20),              -- basic/pro/enterprise
    status VARCHAR(20),            -- active/suspended/trial
    quota_api_calls INT,           -- APIè°ƒç”¨é…é¢
    quota_storage_mb INT,          -- å­˜å‚¨é…é¢
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

#### 2. ç”¨æˆ·è¡¨ (users)
```sql
CREATE TABLE users (
    id VARCHAR(36) PRIMARY KEY,
    tenant_id VARCHAR(36) NOT NULL,  -- å…³è”ç§Ÿæˆ·
    email VARCHAR(100) UNIQUE NOT NULL,
    username VARCHAR(50),
    password_hash VARCHAR(255),
    role VARCHAR(20),                 -- admin/user/viewer
    is_active BOOLEAN DEFAULT true,
    last_login TIMESTAMP,
    created_at TIMESTAMP,
    FOREIGN KEY (tenant_id) REFERENCES tenants(id)
);
```

#### 3. å¯¹è¯å†å²è¡¨ (conversations)
```sql
CREATE TABLE conversations (
    id VARCHAR(36) PRIMARY KEY,
    tenant_id VARCHAR(36) NOT NULL,  -- æ•°æ®éš”ç¦»ï¼
    user_id VARCHAR(36) NOT NULL,
    title VARCHAR(200),
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    FOREIGN KEY (tenant_id) REFERENCES tenants(id),
    FOREIGN KEY (user_id) REFERENCES users(id),
    INDEX idx_tenant_user (tenant_id, user_id)
);
```

#### 4. æ¶ˆæ¯è¡¨ (messages)
```sql
CREATE TABLE messages (
    id VARCHAR(36) PRIMARY KEY,
    conversation_id VARCHAR(36) NOT NULL,
    tenant_id VARCHAR(36) NOT NULL,  -- åŒé‡ä¿é™©
    role VARCHAR(20),                 -- user/assistant/system
    content TEXT,
    tokens_used INT,
    created_at TIMESTAMP,
    FOREIGN KEY (conversation_id) REFERENCES conversations(id),
    INDEX idx_conversation (conversation_id)
);
```

#### 5. MCPæœåŠ¡é…ç½®è¡¨ (mcp_services)
```sql
CREATE TABLE mcp_services (
    id VARCHAR(36) PRIMARY KEY,
    tenant_id VARCHAR(36) NOT NULL,  -- æ¯ä¸ªç§Ÿæˆ·å¯é…ç½®è‡ªå·±çš„æœåŠ¡
    name VARCHAR(100),
    url VARCHAR(500),
    type VARCHAR(50),
    config JSON,                      -- æœåŠ¡ç‰¹å®šé…ç½®
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP,
    FOREIGN KEY (tenant_id) REFERENCES tenants(id)
);
```

#### 6. ä½¿ç”¨é‡ç»Ÿè®¡è¡¨ (usage_stats)
```sql
CREATE TABLE usage_stats (
    id VARCHAR(36) PRIMARY KEY,
    tenant_id VARCHAR(36) NOT NULL,
    user_id VARCHAR(36),
    date DATE,
    api_calls INT DEFAULT 0,
    tokens_used INT DEFAULT 0,
    storage_used_mb INT DEFAULT 0,
    FOREIGN KEY (tenant_id) REFERENCES tenants(id),
    INDEX idx_tenant_date (tenant_id, date)
);
```

---

## ğŸ”’ ç§Ÿæˆ·éš”ç¦»ç­–ç•¥

### ç­–ç•¥1ï¼šå…±äº«æ•°æ®åº“ + tenant_idï¼ˆæ¨èï¼‰

**ä¼˜ç‚¹**ï¼š
- âœ… æˆæœ¬ä½ï¼Œæ˜“äºç»´æŠ¤
- âœ… èµ„æºåˆ©ç”¨ç‡é«˜
- âœ… ä¾¿äºè·¨ç§Ÿæˆ·åˆ†æ

**å®ç°**ï¼š
```python
# è£…é¥°å™¨è‡ªåŠ¨æ³¨å…¥tenant_id
@require_tenant
def get_conversations(tenant_id, user_id):
    return Conversation.query.filter_by(
        tenant_id=tenant_id,
        user_id=user_id
    ).all()
```

**æ³¨æ„**ï¼š
- âš ï¸ å¿…é¡»åœ¨æ‰€æœ‰æŸ¥è¯¢ä¸­åŠ å…¥tenant_idè¿‡æ»¤
- âš ï¸ éœ€è¦ä¸¥æ ¼çš„ä»£ç å®¡æŸ¥é˜²æ­¢æ•°æ®æ³„éœ²

### ç­–ç•¥2ï¼šç‹¬ç«‹æ•°æ®åº“

**ä¼˜ç‚¹**ï¼š
- âœ… æœ€å¼ºéš”ç¦»æ€§
- âœ… é€‚åˆå¤§å®¢æˆ·
- âœ… æ˜“äºè¿ç§»

**å®ç°**ï¼š
```python
# æ ¹æ®ç§Ÿæˆ·è·¯ç”±åˆ°ä¸åŒæ•°æ®åº“
def get_db_connection(tenant_id):
    db_config = TENANT_DBS[tenant_id]
    return create_connection(db_config)
```

### ç­–ç•¥3ï¼šæ··åˆæ¨¡å¼ï¼ˆæ¨èå¤§å‹SaaSï¼‰

```
å°ç§Ÿæˆ· â†’ å…±äº«æ•°æ®åº“
å¤§ç§Ÿæˆ· â†’ ç‹¬ç«‹æ•°æ®åº“
è¶…å¤§å®¢æˆ· â†’ ç‹¬ç«‹éƒ¨ç½²
```

---

## ğŸ” è®¤è¯æˆæƒæ–¹æ¡ˆ

### JWT Tokenè®¤è¯

```python
# ç™»å½•è·å–Token
POST /api/auth/login
{
    "email": "user@example.com",
    "password": "xxx"
}

# å“åº”
{
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refresh_token": "xxx",
    "user": {
        "id": "user-123",
        "tenant_id": "tenant-456",
        "role": "admin"
    }
}

# åç»­è¯·æ±‚æºå¸¦Token
GET /api/conversations
Headers: Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### RBACæƒé™æ§åˆ¶

```python
# è§’è‰²å®šä¹‰
ROLES = {
    'admin': [
        'manage_users',
        'manage_services',
        'view_stats',
        'all_conversations'
    ],
    'user': [
        'create_conversation',
        'view_own_conversations',
        'use_mcp_services'
    ],
    'viewer': [
        'view_own_conversations'
    ]
}

# æƒé™è£…é¥°å™¨
@require_permission('manage_users')
def create_user(tenant_id, user_data):
    # åªæœ‰adminå¯ä»¥åˆ›å»ºç”¨æˆ·
    pass
```

---

## ğŸ“Š èµ„æºé…é¢ä¸é™æµ

### é…é¢æ£€æŸ¥

```python
class QuotaManager:
    def check_api_quota(self, tenant_id):
        """æ£€æŸ¥APIè°ƒç”¨é…é¢"""
        tenant = Tenant.get(tenant_id)
        usage = get_monthly_usage(tenant_id)
        
        if usage.api_calls >= tenant.quota_api_calls:
            raise QuotaExceededError("APIè°ƒç”¨æ¬¡æ•°å·²è¾¾ä¸Šé™")
    
    def check_storage_quota(self, tenant_id, size_mb):
        """æ£€æŸ¥å­˜å‚¨é…é¢"""
        tenant = Tenant.get(tenant_id)
        current = get_storage_usage(tenant_id)
        
        if current + size_mb > tenant.quota_storage_mb:
            raise QuotaExceededError("å­˜å‚¨ç©ºé—´ä¸è¶³")
```

### è¯·æ±‚é™æµ

```python
from flask_limiter import Limiter

# æ ¹æ®ç§Ÿæˆ·é™æµ
limiter = Limiter(
    key_func=lambda: get_tenant_id(),
    default_limits=["100 per minute"]
)

# ä¸åŒå¥—é¤ä¸åŒé™é¢
@limiter.limit("1000/minute", key_func=lambda: get_tenant_plan())
@app.route('/api/chat')
def chat():
    pass
```

---

## ğŸ’° è®¡è´¹ç³»ç»Ÿè®¾è®¡

### å¥—é¤å®šä¹‰

```python
PLANS = {
    'free': {
        'price': 0,
        'api_calls': 1000,      # æœˆ
        'storage_mb': 100,
        'users': 1,
        'mcp_services': 1
    },
    'basic': {
        'price': 99,            # å…ƒ/æœˆ
        'api_calls': 10000,
        'storage_mb': 1000,
        'users': 5,
        'mcp_services': 5
    },
    'pro': {
        'price': 499,
        'api_calls': 100000,
        'storage_mb': 10000,
        'users': 20,
        'mcp_services': 20
    },
    'enterprise': {
        'price': 'custom',
        'api_calls': 'unlimited',
        'storage_mb': 'unlimited',
        'users': 'unlimited',
        'mcp_services': 'unlimited'
    }
}
```

### ä½¿ç”¨é‡ç»Ÿè®¡

```python
class UsageTracker:
    def track_api_call(self, tenant_id, tokens_used):
        """è®°å½•APIè°ƒç”¨"""
        today = date.today()
        usage = UsageStats.get_or_create(tenant_id, today)
        usage.api_calls += 1
        usage.tokens_used += tokens_used
        usage.save()
    
    def generate_invoice(self, tenant_id, month):
        """ç”Ÿæˆè´¦å•"""
        usage = UsageStats.get_monthly(tenant_id, month)
        plan = Tenant.get(tenant_id).plan
        
        # è®¡ç®—è¶…é¢è´¹ç”¨
        overage = calculate_overage(usage, plan)
        
        return {
            'base_fee': PLANS[plan]['price'],
            'overage_fee': overage,
            'total': PLANS[plan]['price'] + overage
        }
```

---

## ğŸš€ å®æ–½è·¯çº¿å›¾

### é˜¶æ®µ1ï¼šåŸºç¡€å¤šç§Ÿæˆ·ï¼ˆ1-2å‘¨ï¼‰âœ… å¿…éœ€

**åŠŸèƒ½**ï¼š
- [x] ç”¨æˆ·æ³¨å†Œ/ç™»å½•
- [x] JWTè®¤è¯
- [x] ç§Ÿæˆ·è¯†åˆ«
- [x] æ•°æ®éš”ç¦»ï¼ˆtenant_idï¼‰
- [x] åŸºç¡€æƒé™æ§åˆ¶

**æ•°æ®åº“**ï¼š
- åˆ›å»ºç§Ÿæˆ·ã€ç”¨æˆ·è¡¨
- æ‰€æœ‰ä¸šåŠ¡è¡¨æ·»åŠ tenant_id

### é˜¶æ®µ2ï¼šèµ„æºç®¡ç†ï¼ˆ1å‘¨ï¼‰âš ï¸ é‡è¦

**åŠŸèƒ½**ï¼š
- [x] é…é¢ç®¡ç†
- [x] è¯·æ±‚é™æµ
- [x] ä½¿ç”¨é‡ç»Ÿè®¡
- [x] å‘Šè­¦é€šçŸ¥

### é˜¶æ®µ3ï¼šè®¡è´¹ç³»ç»Ÿï¼ˆ2-3å‘¨ï¼‰ğŸ’° å•†ä¸šåŒ–å¿…éœ€

**åŠŸèƒ½**ï¼š
- [x] å¥—é¤ç®¡ç†
- [x] è´¦å•ç”Ÿæˆ
- [x] æ”¯ä»˜é›†æˆï¼ˆæ”¯ä»˜å®/å¾®ä¿¡æ”¯ä»˜ï¼‰
- [x] å‘ç¥¨å¼€å…·

### é˜¶æ®µ4ï¼šé«˜çº§åŠŸèƒ½ï¼ˆ2-4å‘¨ï¼‰ğŸ¯ å¢å€¼åŠŸèƒ½

**åŠŸèƒ½**ï¼š
- [x] å›¢é˜Ÿåä½œ
- [x] å®¡è®¡æ—¥å¿—
- [x] æ•°æ®å¯¼å‡º
- [x] APIå¯†é’¥ç®¡ç†
- [x] Webhooké€šçŸ¥
- [x] ç™½æ ‡å®šåˆ¶

---

## ğŸ’» æŠ€æœ¯æ ˆæ¨è

### åç«¯å¢å¼º
```python
# å½“å‰ï¼šFlask
# éœ€è¦æ·»åŠ ï¼š
- Flask-JWT-Extended     # JWTè®¤è¯
- Flask-SQLAlchemy       # ORM
- Flask-Migrate          # æ•°æ®åº“è¿ç§»
- Flask-Limiter          # é™æµ
- Flask-CORS             # è·¨åŸŸ
- Celery                 # å¼‚æ­¥ä»»åŠ¡
- Redis                  # ç¼“å­˜ã€ä¼šè¯ã€é™æµ
```

### æ•°æ®åº“
```
ä¸»æ•°æ®åº“ï¼šPostgreSQLï¼ˆæ¨èï¼‰/ MySQL
ç¼“å­˜ï¼šRedis
æœç´¢ï¼šElasticsearchï¼ˆå¯é€‰ï¼‰
```

### å‰ç«¯å¢å¼º
```javascript
// éœ€è¦æ·»åŠ ï¼š
- ç”¨æˆ·ç™»å½•/æ³¨å†Œç•Œé¢
- ç§Ÿæˆ·ç®¡ç†åå°
- ç”¨é‡ç»Ÿè®¡ä»ªè¡¨æ¿
- è®¡è´¹ä¸­å¿ƒ
- å›¢é˜Ÿç®¡ç†
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜ç­–ç•¥
```python
# Redisç¼“å­˜ç§Ÿæˆ·ä¿¡æ¯
@cache.memoize(timeout=3600)
def get_tenant(tenant_id):
    return Tenant.query.get(tenant_id)

# ç¼“å­˜ç”¨æˆ·æƒé™
@cache.memoize(timeout=600)
def get_user_permissions(user_id):
    return User.query.get(user_id).get_permissions()
```

### æ•°æ®åº“ä¼˜åŒ–
```sql
-- å…³é”®ç´¢å¼•
CREATE INDEX idx_tenant_id ON conversations(tenant_id);
CREATE INDEX idx_tenant_user ON conversations(tenant_id, user_id);
CREATE INDEX idx_created_at ON messages(created_at);

-- åˆ†åŒºè¡¨ï¼ˆå¤§æ•°æ®é‡ï¼‰
CREATE TABLE messages_2025_01 PARTITION OF messages
FOR VALUES FROM ('2025-01-01') TO ('2025-02-01');
```

### è¯»å†™åˆ†ç¦»
```python
# ä¸»åº“å†™å…¥
primary_db.execute(insert_query)

# ä»åº“è¯»å–
replica_db.execute(select_query)
```

---

## ğŸ”’ å®‰å…¨åŠ å›º

### 1. SQLæ³¨å…¥é˜²æŠ¤
```python
# âœ… ä½¿ç”¨ORM
User.query.filter_by(email=email).first()

# âŒ ä¸è¦æ‹¼æ¥SQL
db.execute(f"SELECT * FROM users WHERE email='{email}'")
```

### 2. XSSé˜²æŠ¤
```python
from markupsafe import escape
content = escape(user_input)
```

### 3. CSRFé˜²æŠ¤
```python
from flask_wtf.csrf import CSRFProtect
csrf = CSRFProtect(app)
```

### 4. å¯†ç åŠ å¯†
```python
from werkzeug.security import generate_password_hash, check_password_hash

# å­˜å‚¨
password_hash = generate_password_hash(password)

# éªŒè¯
check_password_hash(password_hash, password)
```

### 5. APIå¯†é’¥ç®¡ç†
```python
# ä¸ºæ¯ä¸ªç§Ÿæˆ·ç”ŸæˆAPI Key
api_key = secrets.token_urlsafe(32)

# ä½¿ç”¨æ—¶éªŒè¯
@require_api_key
def api_endpoint():
    pass
```

---

## ğŸ“Š ç›‘æ§ä¸è¿ç»´

### å…³é”®æŒ‡æ ‡

```python
# ä¸šåŠ¡æŒ‡æ ‡
- æ´»è·ƒç§Ÿæˆ·æ•°
- æ—¥æ´»ç”¨æˆ·æ•°ï¼ˆDAUï¼‰
- APIè°ƒç”¨é‡
- å¹³å‡å“åº”æ—¶é—´
- é”™è¯¯ç‡

# èµ„æºæŒ‡æ ‡
- CPUä½¿ç”¨ç‡
- å†…å­˜ä½¿ç”¨ç‡
- æ•°æ®åº“è¿æ¥æ•°
- Rediså‘½ä¸­ç‡
- ç£ç›˜ä½¿ç”¨ç‡

# æ”¶å…¥æŒ‡æ ‡
- MRR (æœˆåº¦ç»å¸¸æ€§æ”¶å…¥)
- ARR (å¹´åº¦ç»å¸¸æ€§æ”¶å…¥)
- å®¢æˆ·æµå¤±ç‡
- ARPU (æ¯ç”¨æˆ·å¹³å‡æ”¶å…¥)
```

### å‘Šè­¦é…ç½®
```python
# é˜¿é‡Œäº‘äº‘ç›‘æ§
- APIé”™è¯¯ç‡ > 5%
- å“åº”æ—¶é—´ > 3s
- é…é¢ä½¿ç”¨ç‡ > 90%
- æ•°æ®åº“è¿æ¥æ•° > 80%
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ç§Ÿæˆ·æ•°æ®å®Œå…¨éš”ç¦»
```python
# åœ¨æ‰€æœ‰æŸ¥è¯¢ä¸­å¼ºåˆ¶æ·»åŠ tenant_id
class TenantQuery:
    def filter(self, **kwargs):
        kwargs['tenant_id'] = g.tenant_id
        return super().filter(**kwargs)
```

### 2. ä¼˜é›…é™çº§
```python
# å½“æŸä¸ªç§Ÿæˆ·è¶…é…é¢æ—¶ï¼Œåªå½±å“è¯¥ç§Ÿæˆ·
if is_quota_exceeded(tenant_id):
    return throttle_response()
else:
    return normal_response()
```

### 3. å®¡è®¡æ—¥å¿—
```python
# è®°å½•æ‰€æœ‰æ•æ„Ÿæ“ä½œ
@audit_log
def delete_user(user_id):
    log_event('user_deleted', {
        'user_id': user_id,
        'operator': current_user.id,
        'tenant_id': g.tenant_id
    })
```

### 4. æ•°æ®å¤‡ä»½
```bash
# æ¯æ—¥å¤‡ä»½
0 2 * * * /backup/backup_tenant_data.sh

# æ”¯æŒç§Ÿæˆ·çº§åˆ«æ¢å¤
./restore_tenant.sh tenant-123 2025-01-20
```

---

## ğŸ¯ æ€»ç»“

### å½“å‰ç‰ˆæœ¬ â†’ SaaSç‰ˆæœ¬

| ç‰¹æ€§ | å½“å‰ | SaaSç‰ˆæœ¬ |
|------|------|----------|
| **å¤šç§Ÿæˆ·** | âŒ ä¸æ”¯æŒ | âœ… å®Œæ•´æ”¯æŒ |
| **ç”¨æˆ·è®¤è¯** | âŒ æ—  | âœ… JWT + å¤šç§ç™»å½•æ–¹å¼ |
| **æƒé™ç®¡ç†** | âŒ æ—  | âœ… RBAC |
| **æ•°æ®éš”ç¦»** | âŒ æ—  | âœ… tenant_idéš”ç¦» |
| **é…é¢ç®¡ç†** | âŒ æ—  | âœ… å¤šçº§é…é¢ |
| **è®¡è´¹ç³»ç»Ÿ** | âŒ æ—  | âœ… è‡ªåŠ¨è®¡è´¹ |
| **ä½¿ç”¨ç»Ÿè®¡** | âŒ æ—  | âœ… è¯¦ç»†ç»Ÿè®¡ |
| **APIç®¡ç†** | âŒ æ—  | âœ… API Key |

### å®æ–½æˆæœ¬ä¼°ç®—

**å¼€å‘æˆæœ¬**ï¼š
- åŸºç¡€å¤šç§Ÿæˆ·ï¼š1-2äººå‘¨
- å®Œæ•´SaaSï¼š4-8äººå‘¨
- é«˜çº§åŠŸèƒ½ï¼šå¦åŠ 2-4äººå‘¨

**è¿ç»´æˆæœ¬**ï¼š
- æœåŠ¡å™¨ï¼šæ ¹æ®ç§Ÿæˆ·æ•°é‡
- æ•°æ®åº“ï¼šPostgreSQL + Redis
- ç›‘æ§ï¼šé˜¿é‡Œäº‘äº‘ç›‘æ§ï¼ˆå…è´¹ï¼‰

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

**ç«‹å³å¯åš**ï¼š
1. è®¾è®¡æ•°æ®åº“è¡¨ç»“æ„
2. å®ç°ç”¨æˆ·è®¤è¯
3. æ·»åŠ ç§Ÿæˆ·è¯†åˆ«

**éœ€è¦æ‚¨å†³ç­–**ï¼š
1. æ˜¯å¦éœ€è¦SaaSåŒ–ï¼Ÿ
2. ç›®æ ‡å®¢æˆ·æ˜¯è°ï¼Ÿ
3. é¢„ç®—å’Œæ—¶é—´ï¼Ÿ

---

**æˆ‘å¯ä»¥å¸®æ‚¨å®ç°å®Œæ•´çš„å¤šç§Ÿæˆ·SaaSç‰ˆæœ¬ï¼** ğŸ’ª

éœ€è¦æˆ‘å¼€å§‹å®ç°å—ï¼Ÿæˆ‘å¯ä»¥ï¼š
1. åˆ›å»ºæ•°æ®åº“æ¨¡å‹
2. å®ç°ç”¨æˆ·è®¤è¯
3. æ·»åŠ ç§Ÿæˆ·ç®¡ç†
4. é…ç½®èµ„æºé…é¢
5. åˆ›å»ºç®¡ç†åå°

å‘Šè¯‰æˆ‘æ‚¨çš„éœ€æ±‚ï¼Œæˆ‘ç«‹å³å¼€å§‹ï¼ğŸš€
